<script type="text/javascript">
	RED.nodes.registerType('decrypt', {
		category: 'function',
		color: '#a6bbcf',
		defaults: {
			name: {value: ''}, algorithm: {value: '', required: false}, mode: {value: '', required: false}, padding: {value: '', required: false}, key: {value: '', required: false}
		},
		inputs: 1,
		outputs: 1,
		icon: "hash.png",
		label: function () {
			return this.name || "decrypt";
        },
        oneditprepare: function (scope) {
            $('#node-input-algorithm').on('change', function(e) {
                var value = e.target.value;
                var isBlockCipher = (value === "AES" || value === "DES" || value === "TripleDES");

                $('.decrypt-mode').toggle(isBlockCipher);
                $('.decrypt-padding').toggle(isBlockCipher);
            });
        }
    });
</script>

<script type="text/x-red" data-template-name="decrypt">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-algorithm"><i class="icon-tag"></i> Algorithm</label>
        <select type="text" id="node-input-algorithm" style="width:70%;">
            <option value="AES">AES</option>
            <option value="DES">DES</option>
            <option value="RC4">RC4</option>
            <option value="Rabbit">Rabbit</option>
            <option value="TripleDES">TripleDES</option>
        </select>
    </div>
    <div class="form-row decrypt-mode">
        <label for="node-input-mode"><i class="icon-tag"></i> Mode</label>
        <select type="text" id="node-input-mode" style="width:70%;">
            <option value="CBC">CBC (default)</option>
            <option value="CFB">CFB</option>
            <option value="CTR">CTR</option>
            <option value="OFB">OFB</option>
            <option value="ECB">ECB</option>
        </select>
    </div>
    <div class="form-row decrypt-padding">
        <label for="node-input-padding"><i class="icon-tag"></i> Padding</label>
        <select type="text" id="node-input-padding" style="width:70%;">
            <option value="Pkcs7">Pkcs7 (default)</option>
            <option value="Iso97971">Iso97971</option>
            <option value="AnsiX923">AnsiX923</option>
            <option value="Iso10126">Iso10126</option>
            <option value="ZeroPadding">ZeroPadding</option>
            <option value="NoPadding">NoPadding</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-key"><i class="icon-tag"></i> Secret Key</label>
        <input type="text" id="node-input-key" placeholder="Secret Key">
    </div>
</script>

<script type="text/x-red" data-help-name="decrypt">
    <p>Decrypt the payload using the specified algorithm.</p>
    <p><strong>Input</strong></p>
    <p>You can set values dynamically by using:<br/>
        <code>msg.algorithm</code> Algorithm<br/>
        <code>msg.mode</code> Cipher mode<br/>
        <code>msg.padding</code> Padding mode<br/>
        <code>msg.key</code> Secret Key<br/>
        <code>msg.drop</code> Drop<br/>
        <code>msg.iv</code> Initialization vector<br/>
        <code>msg.salt</code> Salt
    </p>
    <p><strong>Output</strong></p>
    <p>
        <code>msg.payload</code> Decryption output converted to string.
    </p>
</script>